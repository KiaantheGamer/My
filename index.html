<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Internet Speed Test</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    text-align: center;
    padding: 40px 20px;
}
h1 {
    margin-bottom: 20px;
}
button {
    padding: 14px 28px;
    font-size: 18px;
    background: #4CAF50;
    color: white;
    border: none;
    border-radius: 8px;
}
button:disabled {
    background: #9ccc9c;
}
#result {
    margin-top: 25px;
    font-size: 20px;
}
.big {
    font-size: 34px;
    font-weight: bold;
}
</style>
</head>

<body>

<h1>Internet Speed Test</h1>
<button id="btn" onclick="startTest()">Start Test</button>

<div id="result"></div>

<script>
async function testPing() {
    const start = performance.now();
    await fetch("https://speed.cloudflare.com/__down?bytes=1&x=" + Math.random(), {
        cache: "no-store"
    });
    return Math.round(performance.now() - start);
}

async function testDownload() {
    const start = performance.now();
    const res = await fetch("https://speed.cloudflare.com/__down?bytes=8000000&x=" + Math.random(), {
        cache: "no-store"
    });
    const data = await res.arrayBuffer();
    const end = performance.now();

    const seconds = (end - start) / 1000;
    const bits = data.byteLength * 8;
    return (bits / seconds / 1_000_000);
}

async function testUpload() {
    const size = 4 * 1024 * 1024; // 4MB
    const buffer = new Uint8Array(size);
    const start = performance.now();

    await fetch("https://speed.cloudflare.com/__up", {
        method: "POST",
        body: buffer,
        headers: { "Content-Type": "application/octet-stream" }
    });

    const end = performance.now();
    const seconds = (end - start) / 1000;
    const bits = size * 8;
    return (bits / seconds / 1_000_000);
}

async function startTest() {
    const btn = document.getElementById("btn");
    const result = document.getElementById("result");
    btn.disabled = true;

    result.innerHTML = "Testing ping...";
    const ping = await testPing();
    result.innerHTML = `Ping: ${ping} ms<br><br>Testing download...`;

    const down = await testDownload();
    result.innerHTML = `
        Ping: ${ping} ms<br><br>
        <b>Download Speed</b><br>
        <div class="big">${down.toFixed(2)} Mbps</div><br>
        Testing upload...
    `;

    const up = await testUpload();

    result.innerHTML = `
        Ping: ${ping} ms<br><br>
        <b>Download Speed</b><br>
        <div class="big">${down.toFixed(2)} Mbps</div><br><br>
        Upload Speed: ${up.toFixed(2)} Mbps
    `;

    btn.disabled = false;
}
</script>

</body>
</html>
